## 目标
- 将每日飞书通知从“当天所有累计内容”改为“相较上一次，仅推送当天新增的内容”。

## 现状
- 定时工作流在 `.github/workflows/schedule-update.yml:74-154` 构建并发送卡片消息，直接读取当天 `raw/*/YYYY-MM-DD.json` 的“全量合并结果”，因此每次都是当日完整列表。
- Push 触发的工作流 `.github/workflows/feishu_notification.yml:23-41` 会把最近一次提交中的新增文本行作为纯文本消息发送（与热榜无关）。

## 改动思路
- 在定时工作流的“发送通知”步骤内，按站点对比“当前工作区 JSON”与“上一个提交（HEAD~1）中的同日 JSON”，只取新增条目的差集作为消息内容；若三站点均无新增，则跳过发送。
- 不引入额外状态文件，直接利用 Git 提交历史作为“上一次”的基准；首次执行或首次有当日文件时，`HEAD~1` 不存在该文件则视为之前为空，等价于推送全部当前条目。

## 具体实现（Shell + jq）
- 在 `.github/workflows/schedule-update.yml` 的“Step 8: Build and Send Notifications from JSON Files”内，替换列表构建为差集构建：
```
# 读取当天文件
CURRENT_DATE=$(date +%Y-%m-%d)
KR_JSON=$(cat ./raw/36kr/$CURRENT_DATE.json 2>/dev/null || echo "[]")
JUEJIN_JSON=$(cat ./raw/juejin/$CURRENT_DATE.json 2>/dev/null || echo "[]")
GITHUB_JSON=$(cat ./raw/github/$CURRENT_DATE.json 2>/dev/null || echo "[]")

# 读取上一提交中的同日文件（不存在则为空）
PREV_KR_JSON=$(git show HEAD~1:./raw/36kr/$CURRENT_DATE.json 2>/dev/null || echo "[]")
PREV_JUEJIN_JSON=$(git show HEAD~1:./raw/juejin/$CURRENT_DATE.json 2>/dev/null || echo "[]")
PREV_GITHUB_JSON=$(git show HEAD~1:./raw/github/$CURRENT_DATE.json 2>/dev/null || echo "[]")

# 计算新增项：当前中 URL 不在上一提交的 URL 集合里
KR_NEW=$(jq --argjson prev "$PREV_KR_JSON" '[.[] | select((.url) as $u | ($prev | map(.url) | index($u) | not))]' <<< "$KR_JSON")
JUEJIN_NEW=$(jq --argjson prev "$PREV_JUEJIN_JSON" '[.[] | select((.url) as $u | ($prev | map(.url) | index($u) | not))]' <<< "$JUEJIN_JSON")
GITHUB_NEW=$(jq --argjson prev "$PREV_GITHUB_JSON" '[.[] | select((.url) as $u | ($prev | map(.url) | index($u) | not))]' <<< "$GITHUB_JSON")

# 转为 Markdown 列表（沿用现有 json_to_markdown_list）
KR_MD=$(echo "$KR_NEW" | json_to_markdown_list)
JUEJIN_MD=$(echo "$JUEJIN_NEW" | json_to_markdown_list)
GITHUB_MD=$(echo "$GITHUB_NEW" | json_to_markdown_list)

# 若三者均为空，则跳过发送
if [ -z "$KR_MD$JUEJIN_MD$GITHUB_MD" ]; then
  echo "No incremental updates today. Skipping Feishu notification."
  exit 0
fi

# 其余卡片 elements 构建逻辑保持不变，但仅添加非空分段
```
- 保留现有 header、按钮与多 webhook 发送逻辑；“更新时间”可继续显示当前时间。

## 边界与行为
- 首次当日有数据或首次运行：上一提交没有当日文件，新增=当前全量，将发送一次完整列表；后续运行只推新增。
- 若当次抓取无新增（仓库也不会提交变更）：三段均为空，直接跳过，无重复消息。
- 不依赖 `has_changes` 输出；即使仓库变更与热榜无关，也不会发送空内容。

## 验证与回滚
- 手动触发一次 `workflow_dispatch`：
  - 第一次应看到完整当日列表；第二次仅看到新增条目或跳过。
- 样例检查：在卡片中确认仅出现新增的项目；无新增则日志显示跳过。
- 出现异常时可快速回退为“全量发送”（恢复原先 Markdown 构建使用 `KR_JSON/JUEJIN_JSON/GITHUB_JSON`）。

## 可选后续
- 若需“相较上一次发送”而非“相较上一次提交”，可在仓库中维护 `.state/` 的已发送快照文件并在步骤中读写它；当前方案更简洁，无额外持久化。